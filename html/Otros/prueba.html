<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Proyecto</title>

  <!-- Bootstrap Core CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet">

  <style>
    .mostrar{
      display: grid;
      grid-template-columns:  repeat(3, 100px) 40px;
      grid-gap: 1em;
      margin: 20px; 
  }
  </style>

</head>

<body>

  <button type="button" class="btn btn-primary" onclick="mostrarModal();">
    Launch demo modal
  </button>

  <div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          .  <div class="mostrar">
    
            <select class="form-control tnq" id="cmbTanque1"></select>
            <input type="number" class="form-control tnq" id="txtCantidad1" placeholder="Cantidad">
            <input type="number" class="form-control tnq" id="txtTotal1" placeholder="Total" readonly>
            <button class="btn btn-warning" id="btnEliminar1" type="button">X</button>
        
            <select class="form-control tnq" id="cmbTanque2"></select>
            <input type="number" class="form-control tnq" id="txtCantidad2" placeholder="Cantidad">
            <input type="number" class="form-control tnq" id="txtTotal2" placeholder="Total" readonly>
            <button class="btn btn-warning" id="btnEliminar2" type="button">X</button>
        
            <select class="form-control tnq" id="cmbTanque3"></select>
            <input type="number" class="form-control tnq" id="txtCantidad3" placeholder="Cantidad">
            <input type="number" class="form-control tnq" id="txtTotal3" placeholder="Total" readonly>
            <button class="btn btn-warning" id="btnEliminar3" type="button">X</button>
        
            <select class="form-control tnq" id="cmbTanque4"></select>
            <input type="number" class="form-control tnq" id="txtCantidad4" placeholder="Cantidad">
            <input type="number" class="form-control tnq" id="txtTotal4" placeholder="Total" readonly>
            <button class="btn btn-warning" id="btnEliminar4" type="button">X</button>
        
            <select class="form-control tnq" id="cmbTanque5"></select>
            <input type="number" class="form-control tnq" id="txtCantidad5" placeholder="Cantidad">
            <input type="number" class="form-control tnq" id="txtTotal5" placeholder="Total" readonly>
            <button class="btn btn-warning eliminarTanque" id="btnEliminar5" type="button">X</button>
            
            <label for="" class="labelTotalTanques">Total</label>
            <input type="number" class="form-control sumaTanques tnq" id="sumaTanques" readonly>  
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
          <button type="button" class="btn btn-primary">Guardar</button>
        </div>
      </div>
    </div>
  </div>


  
  
  
 <!-- jquery -->
 <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>
 <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
 <!-- <script src="js/utils/jquery.slimscroll.js"></script> -->

<script>
  function mostrarModal(){
    $('#exampleModalLongTitle').show();
    cargarTanques();
  }
</script>


  <script>
    
function cargarTanques() {
    $.ajax({
        type: "POST",
        'url' : 'php/listarBatch.php',
        'data':{"operacion" : "9"},
        success: function(r){
            var info = JSON.parse(r);
            
            for (i=1; i<6; i++){
                $('#cmbTanque'+i).empty();
                let $select = $('#cmbTanque'+ i);
                $select.append('<option disabled selected>' + "Tanque" + '</option>');    
                $.each(info, function(i, value) {
                    $select.append('<option value ="'+  value.capacidad + '">' + value.capacidad + '</option>');
                 })

            }
        }
    })
}
  </script>


<script>
  $(document).on('click', '.link-editar', function(e){
    e.preventDefault();
    editar = true;
    limpiarTanques();
    OcultarTanques();

    var texto = $(this).parent().parent().children()[1];
    var id = $(texto).text();
    
    $.ajax({
        method: 'POST',
        url : 'php/listarBatch.php',
        data: {operacion : "6", id : id},  
        
        
         success: function(response){
            
            var info = JSON.parse(response);
            let sum = 0;

            $('#idbatch').val(info[0].id_batch);
            $('#referencia').val(info[0].referencia);
            $('#nombrereferencia').val(info[0].nombre_referencia);
            $('#marca').val(info[0].marca);
            $('#propietario').val(info[0].propietario);
            $('#producto').val(info[0].nombre_referencia);
            $('#presentacioncomercial').val(info[0].presentacion);
            $('#linea').val(info[0].linea);
            $('#notificacionSanitaria').val(info[0].notificacion_sanitaria);
            $('#densidad').val(info[0].densidad);
            $('#unidadesxlote').val(info[0].unidad_lote);
            $('#tamanototallote').val(info[0].tamano_lote);
            $('#fechaprogramacion').val(info[0].fecha_programacion);
            
            unidades = info[0].unidad_lote;
            lote = info[0].tamano_lote;
            
            $('#modalCrearBatch').modal('show');            
            $('.labelTotalTanques').show();
            $('.sumaTanques').show();
            
            cargarTanques();

            for(k=1; k<info.length; k++){
                const cantidad = info[k].cantidad
                const tanque= info[k].tanque
                const total = cantidad * tanque
                
                $('#cmbTanque' + k).show().val(tanque);
                $('#txtCantidad' + k).show().val(cantidad);
                $('#txtTotal' + k).show().val(total);
                $('#btnEliminar' + k).show();
                
                sum = sum + total;
                $('.sumatanques').val(sum);
            }

            $("#cmbNoReferencia"). css("display", "none");
            $("#referencia"). css("display", "block");
            $('#guardarBatch').html('Actualizar');
            $('.tcrearBatch').html('Actualizar Batch Record');
            //$('#modalCrearBatch').modal('show');
            //actualizarTabla();
            
        },
        error: function(response){
            console.log(response);
        } 
    })
})


</script>

</body>


</html>